<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BVGE Skript - Strom & Gas Verkauf</title>
    <link rel="icon" type="image/png" href="Images/Logo.jpg">
    <style>
        /* ...Styles aus Prompt... */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #053d1d 50%, #000000 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .sidebar-nav {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 210px;
            background: linear-gradient(135deg, #216733 0%, #1a4d2e 100%);
            display: flex;
            flex-direction: column;
            align-items: stretch;
            padding-top: 60px;
            z-index: 100;
            box-shadow: 2px 0 16px rgba(0,0,0,0.07);
        }
        .sidebar-nav .nav-tab {
            border-radius: 0 25px 25px 0;
            margin: 0 0 10px 0;
            padding: 18px 30px 18px 32px;
            background: none;
            color: #fff;
            border: none;
            font-size: 1.1em;
            font-weight: 600;
            text-align: left;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            outline: none;
            box-shadow: none;
        }
        .sidebar-nav .nav-tab.active {
            background: linear-gradient(90deg, #27ae60 0%, #2ecc71 100%);
            color: #fff;
            box-shadow: 2px 2px 10px rgba(39, 174, 96, 0.08);
        }
        .sidebar-nav .nav-tab:hover:not(.active) {
            background: rgba(255,255,255,0.08);
            color: #FFD700;
        }
        .sidebar-logo {
            width: 100%;
            text-align: center;
            margin-bottom: 30px;
        }
        .sidebar-logo img {
            width: 90px;
            margin-top: 18px;
            margin-bottom: 10px;
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .container {
            margin-left: 210px;
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #216733 0%, #216733 100%);
            color: #FFD700;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .main-content {
            display: flex;
            flex-direction: row;
            gap: 30px;
            padding: 30px;
        }
        .left-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            flex: 2;
        }
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .stage-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .stage-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        .stage-btn.active {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        .stage-btn:not(.active) {
            background: #ecf0f1;
            color: #34495e;
        }
        .stage-btn:not(.active):hover {
            background: #bdc3c7;
            transform: translateY(-1px);
        }
        .script-content {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .script-title {
            color: #216733;
            font-size: 1.8em;
            margin-bottom: 15px;
            border-bottom: 3px solid #216733;
            padding-bottom: 10px;
        }
        .script-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #2c3e50;
            margin-bottom: 20px;
            white-space: pre-line;
        }
        .tips {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        .tips h4 { margin-bottom: 10px; font-size: 1.2em; }
        .tips ul { list-style: none; }
        .tips li { margin-bottom: 8px; padding-left: 20px; position: relative; }
        .tips li:before { content: "✓"; position: absolute; left: 0; font-weight: bold; }
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 0;
        }
        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .form-group { margin-bottom: 15px; }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #34495e;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        .form-group input:focus {
            outline: none;
            border-color: #3498db;
        }
        .btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1em;
            transition: all 0.3s ease;
            width: 100%;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        .savings-result {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
        }
        .checklist-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .checklist-item:hover { background: #f8f9fa; }
        .checklist-item input { margin-right: 10px; transform: scale(1.2); }
        .objection-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        .objection-btn {
            padding: 10px 15px;
            border: 2px solid #e74c3c;
            background: white;
            color: #e74c3c;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
        }
        .objection-btn:hover, .objection-btn.active {
            background: #e74c3c;
            color: white;
            transform: translateY(-2px);
        }
        .objection-response {
            background: #fff5f5;
            border: 2px solid #e74c3c;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        .objection-response h4 { color: #e74c3c; margin-bottom: 10px; }
        @media (max-width: 1024px) {
            .main-content { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .stage-buttons { flex-direction: column; }
            .stage-btn { text-align: center; }
        }
        .icon { width: 20px; height: 20px; fill: currentColor; }
        .no-select { user-select: none; }
        img { -webkit-user-drag: none; }
        .author-initials {
            position: fixed;
            bottom: 10px;
            right: 15px;
            font-size: 14px;
            color: #999;
            opacity: 0.6;
            font-family: Arial, sans-serif;
            pointer-events: none;
            z-index: 999;
        }
        /* Tabelle für Kundenliste */
        table { width: 100%; border-collapse: collapse; font-size: 0.98em; }
        th, td { padding: 6px 8px; border-bottom: 1px solid #eee; }
        th { background: #f4f4f4; }
        /* CSV Export Button */
        .csv-btn {
            background: linear-gradient(135deg,#f39c12,#e67e22);
            margin-top: 8px;
            width: 100%;
        }
        /* Kleinere Anpassungen für Buttons nebeneinander */
        .client-btns { display: flex; gap: 8px; margin-bottom: 10px; }
        .client-btns .btn { width: 50%; }
        .nav-tabs {
            display: flex;
            gap: 10px;
            background: #f4f4f4;
            padding: 10px 30px 0 30px;
            border-bottom: 2px solid #e0e0e0;
        }
        .nav-tab {
            padding: 12px 28px;
            border: none;
            border-radius: 15px 15px 0 0;
            background: #ecf0f1;
            color: #34495e;
            font-weight: 600;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.2s, color 0.2s;
            margin-bottom: -2px;
        }
        .nav-tab.active {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: #fff;
            border-bottom: 2px solid #27ae60;
            z-index: 2;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        /* --- Календарь --- */
        .calendar-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            text-align: center;
            font-size: 1.1em;
            background: #f8f9fa;
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 4px 24px rgba(33,103,51,0.07);
            margin-bottom: 0;
            position: relative;
            z-index: 1;
            border: 3px solid #27ae60; /* Зеленая обводка */
        }
        .calendar-table th {
            background: linear-gradient(90deg, #216733 0%, #27ae60 100%);
            color: #fff;
            font-weight: 700;
            padding: 10px 0;
            border: none;
            font-size: 1.08em;
            letter-spacing: 1px;
        }
        .calendar-table td {
            padding: 10px 0 6px 0;
            min-width: 48px;
            min-height: 48px;
            border-radius: 12px;
            background: #fff;
            transition: background 0.18s, box-shadow 0.18s, color 0.18s;
            cursor: pointer;
            position: relative;
            border: none;
            outline: none;
        }
        .calendar-table td.today {
            border: 2.5px solid #27ae60;
            background: #eafaf1 !important;
            color: #216733;
            font-weight: bold;
            box-shadow: 0 0 0 2px #27ae6033;
        }
        .calendar-table td[data-has-calls="1"] {
            font-weight: 600;
        }
        .calendar-table td:hover:not(:empty) {
            background: #d6f5e3 !important;
            box-shadow: 0 0 0 2px #27ae6055;
            color: #216733;
            z-index: 2;
        }
        .calendar-table td[data-bg="red"] { background: #ffeaea !important; }
        .calendar-table td[data-bg="yellow"] { background: #fffbe5 !important; }
        .calendar-table td[data-bg="green"] { background: #eafaf1 !important; }
        .calendar-table td:empty { background: #f8f8f8 !important; cursor: default; }
        .calendar-table .cal-day-num {
            font-size: 1.1em;
            margin-bottom: 2px;
            display: block;
        }
        .calendar-table .cal-calls {
            font-size: 0.93em;
            color: #888;
            margin-top: 2px;
            display: block;
        }
        .calendar-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #216733 0%, #27ae60 100%);
            color: #fff;
            border-radius: 12px;
            padding: 10px 18px;
            box-shadow: 0 2px 8px #21673311;
        }
        .calendar-header-bar button {
            font-size: 1.5em;
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            transition: color 0.2s;
            padding: 0 8px;
        }
        .calendar-header-bar button:hover {
            color: #FFD700;
        }
        .calendar-header-bar span {
            font-size: 1.22em;
            font-weight: 600;
            letter-spacing: 1px;
        }
        #calendar-stats {
            background: linear-gradient(90deg, #eafaf1 0%, #fffbe5 100%);
            border-radius: 12px;
            padding: 18px 24px;
            box-shadow: 0 2px 12px #27ae6011;
            font-size: 1.08em;
            margin-top: 18px;
            color: #216733;
        }
        .calendar-table td.selected,
        .calendar-table td:active {
            background: #c6f0d6 !important;
            box-shadow: 0 0 0 3px #27ae60cc;
            color: #216733;
            outline: none;
            z-index: 10;
            position: relative;
        }
        .calendar-table td.today.selected,
        .calendar-table td.selected.today {
            border: 2.5px solid #27ae60;
            box-shadow: 0 0 0 3px #27ae60cc;
            background: #c6f0d6 !important;
            color: #216733;
            z-index: 11;
            position: relative;
        }
    </style>
</head>
<body>
    <div class="sidebar-nav">
        <div class="sidebar-logo">
            <img src="Images/Logo.jpg" alt="BVGE Logo" draggable="false" class="no-select">
        </div>
        <button class="nav-tab active" onclick="showSection('script-section', this)">Skript</button>
        <button class="nav-tab" onclick="showSection('clients-section', this)">Kunden</button>
        <button class="nav-tab" onclick="showSection('tools-section', this)">Tools</button>
        <button class="nav-tab" onclick="showSection('stats-section', this)">Statistik</button>
        <button class="nav-tab" onclick="showSection('calendar-section', this)">Kalender</button>
    </div>
    <div class="container">
        <div class="header">
            <img src="Images/Logo.jpg" alt="BVGE Logo" class="no-select" draggable="false">
            <h1><b> BVGE Consulting Gmbh </b></h1>
            <p><b> Strom & Gas Verkauf - Professionelle Kundenberatung </b></p>
        </div>
        <div class="main-content" style="display: flex; flex-direction: row; gap: 30px; padding: 30px;">
            <div class="left-panel" style="flex:2;">
                <div class="stage-buttons">
                    <button class="stage-btn active" onclick="showStage('greeting', event)">Begrüßung</button>
                    <button class="stage-btn" onclick="showStage('qualification', event)">Bedarfsermittlung</button>
                    <button class="stage-btn" onclick="showStage('presentation', event)">Angebotspräsentation</button>
                    <button class="stage-btn" onclick="showStage('objections', event)">Einwandbehandlung</button>
                    <button class="stage-btn" onclick="showStage('closing', event)">Abschluss</button>
                </div>
                <div class="script-content">
                    <h2 class="script-title" id="stage-title">Begrüßung</h2>
                    <div class="script-text" id="stage-script">
                        Guten Tag! Mein Name ist [IHR NAME], ich rufe von BVGE an.

Wir helfen Familien und Unternehmen dabei, bei ihren Strom- und Gaskosten zu sparen.

Haben Sie 2-3 Minuten Zeit, damit ich Ihnen erklären kann, wie Sie bis zu 15% Ihrer Energiekosten sparen können?
                    </div>
                    <div class="tips" id="stage-tips">
                        <h4>Wichtige Tipps:</h4>
                        <ul>
                            <li>Selbstbewusst und freundlich sprechen</li>
                            <li>Auf Zustimmung zum Gespräch warten</li>
                            <li>Bei Ablehnung höflich verabschieden</li>
                            <li>Sich mit vollem Namen vorstellen</li>
                        </ul>
                    </div>
                </div>
                <div class="card" style="margin-top: 20px;">
                    <h3>
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        Einwandbehandlung
                    </h3>
                    <div class="objection-buttons">
                        <button class="objection-btn" onclick="showObjection('expensive', event)">Zu teuer</button>
                        <button class="objection-btn" onclick="showObjection('think', event)">Muss überlegen</button>
                        <button class="objection-btn" onclick="showObjection('satisfied', event)">Bin zufrieden</button>
                        <button class="objection-btn" onclick="showObjection('distrust', event)">Vertraue nicht</button>
                        <button class="objection-btn" onclick="showObjection('time', event)">Keine Zeit</button>
                        <button class="objection-btn" onclick="showObjection('contract', event)">Vertrag läuft</button>
                    </div>
                    <div id="objection-response"></div>
                </div>
            </div>
            <div class="right-panel" style="flex:1; min-width:320px; max-width:340px;">
                <div class="card">
                    <h3>
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                        Kundendaten
                    </h3>
                    <div class="form-group">
                        <label>Kundenname:</label>
                        <input type="text" id="customer-name" placeholder="Name des Kunden">
                    </div>
                    <div class="form-group">
                        <label>Adresse:</label>
                        <input type="text" id="customer-address" placeholder="Adresse">
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="customer-email" placeholder="Email">
                    </div>
                    <div class="form-group">
                        <label>Stromrechnung (€/Monat):</label>
                        <input type="number" id="electricity-bill" placeholder="z.B. 85">
                    </div>
                    <div class="form-group">
                        <label>Gasrechnung (€/Monat):</label>
                        <input type="number" id="gas-bill" placeholder="z.B. 65">
                    </div>
                    <div class="form-group">
                        <label>Aktueller Anbieter:</label>
                        <input type="text" id="current-provider" placeholder="z.B. Stadtwerke">
                    </div>
                    <div class="client-btns">
                        <button class="btn" onclick="addOrUpdateClient()">Speichern</button>
                        <button class="btn" style="background:#e74c3c; background:linear-gradient(135deg,#e74c3c,#c0392b);" onclick="deleteClient()">Löschen</button>
                    </div>
                </div>
                <div class="card">
                    <h3>
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                        Gesprächs-Checkliste
                    </h3>
                    <div class="checklist-item">
                        <input type="checkbox" id="check-name">
                        <label for="check-name">Kundenname erhalten</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check-bills">
                        <label for="check-bills">Aktuelle Rechnungen erfragt</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check-provider">
                        <label for="check-provider">Aktueller Anbieter ermittelt</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check-address">
                        <label for="check-address">Adresse notiert</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check-contact">
                        <label for="check-contact">Kontaktdaten vollständig</label>
                    </div>
                    <div class="checklist-item">
                        <input type="checkbox" id="check-agreement">
                        <label for="check-agreement">Vertragsbereitschaft geprüft</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="section clients-section">
            <div class="header">
                <h1>Kundenverwaltung</h1>
            </div>
            <div class="main-content">
                <div class="left-panel">
                    <div class="form-group">
                        <label>Suche:</label>
                        <input type="text" id="search-client" placeholder="Nach Kunden suchen..." oninput="renderClients()">
                    </div>
                    <div class="card">
                        <h3>
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            Kundenliste
                        </h3>
                        <table id="clients-table">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>Name</th>
                                    <th>Adresse</th>
                                    <th>Email</th>
                                    <th>Strom</th>
                                    <th>Gas</th>
                                    <th>Anbieter</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dynamische Inhalte -->
                            </tbody>
                        </table>
                        <button class="btn csv-btn" onclick="exportClientsCSV()">CSV Export</button>
                    </div>
                </div>
                <div class="right-panel">
                    <div class="card">
                        <h3>
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                        Kundendaten
                    </div>
                    <div class="form-group">
                        <label>Kundenname:</label>
                        <input type="text" id="kunden-customer-name" placeholder="Name des Kunden">
                    </div>
                    <div class="form-group">
                        <label>Adresse:</label>
                        <input type="text" id="kunden-customer-address" placeholder="Adresse">
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="kunden-customer-email" placeholder="Email">
                    </div>
                    <div class="form-group">
                        <label>Stromrechnung (€/Monat):</label>
                        <input type="number" id="kunden-electricity-bill" placeholder="z.B. 85">
                    </div>
                    <div class="form-group">
                        <label>Gasrechnung (€/Monat):</label>
                        <input type="number" id="kunden-gas-bill" placeholder="z.B. 65">
                    </div>
                    <div class="form-group">
                        <label>Aktueller Anbieter:</label>
                        <input type="text" id="kunden-current-provider" placeholder="z.B. Stadtwerke">
                    </div>
                    <div class="client-btns">
                        <button class="btn" onclick="updateSelectedClient()">Änderungen speichern</button>
                        <button class="btn" style="background:#e74c3c; background:linear-gradient(135deg,#e74c3c,#c0392b);" onclick="deleteClient()">Löschen</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="section tools-section">
            <div class="header">
                <h1>Tools</h1>
            </div>
            <div class="main-content">
                <div class="card">
                    <h3>
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M3 3h18v18H3V3zm2 2v14h14V5H5z"/>
                        </svg>
                        Ersparnis-Rechner
                    </h3>
                    <div class="form-group">
                        <label>Stromrechnung (€/Monat):</label>
                        <input type="number" id="electricity-bill-tool" placeholder="z.B. 85">
                    </div>
                    <div class="form-group">
                        <label>Gasrechnung (€/Monat):</label>
                        <input type="number" id="gas-bill-tool" placeholder="z.B. 65">
                    </div>
                    <button class="btn" onclick="calculateSavings()">Ersparnis berechnen</button>
                    <div id="savings-result-tool" class="savings-result" style="display:none;"></div>
                </div>
            </div>
        </div>
        <div class="section stats-section">
            <div class="header">
                <h1>Statistik &amp; Grafiken</h1>
            </div>
            <div class="main-content" style="flex-direction:column;gap:30px;max-width:900px;margin:0 auto;">
                <div class="card" style="padding: 35px 35px 30px 35px;">
                    <h3 style="font-size:1.5em;align-items:center;">
                        <svg class="icon" viewBox="0 0 24 24" style="width:28px;height:28px;">
                            <path d="M3 17h2v-7H3v7zm4 0h2v-4H7v4zm4 0h2V7h-2v10zm4 0h2v-2h-2v2z"/>
                        </svg>
                        Anruf-Statistik
                    </h3>
                    <div style="display:flex;gap:40px;align-items:flex-start;flex-wrap:wrap;">
                        <div style="min-width:220px;">
                            <div style="font-size:1.15em;margin-bottom:10px;">
                                <b>Gesamtanrufe:</b> <span id="calls-count" style="color:#3498db;font-weight:bold;">0</span>
                            </div>
                            <div style="font-size:1.15em;margin-bottom:18px;">
                                <b>Erfolgreiche Abschlüsse:</b> <span id="success-count" style="color:#27ae60;font-weight:bold;">0</span>
                            </div>
                            <div style="font-size:1.15em;margin-bottom:18px;">
                                <b>Erfolgsquote:</b>
                                <span id="success-rate" style="font-weight:bold;padding:2px 10px;border-radius:8px;background:#eee;color:#888;">0%</span>
                            </div>
                            <div style="margin-bottom:14px;">
                                <label for="stats-filter" style="font-size:1em;font-weight:600;">Zeitraum:</label>
                                <select id="stats-filter" style="margin-left:8px;padding:4px 10px;border-radius:6px;border:1px solid #ccc;" onchange="applyStatsFilter()">
                                    <option value="all">Alle</option>
                                    <option value="day">Heute</option>
                                    <option value="week">Woche</option>
                                    <option value="month">Monat</option>
                                </select>
                            </div>
                            <button class="btn" style="margin-top:5px;width:100%;font-size:1.1em;" onclick="addCall()">Anruf hinzufügen</button>
                            <button class="btn" id="undo-call-btn" style="margin-top:8px;width:100%;font-size:1.1em;background:linear-gradient(135deg,#e74c3c,#c0392b);" onclick="undoLastCall()" disabled>Letzte Aktion rückgängig</button>
                        </div>
                        <div style="flex:1;min-width:400px;max-width:600px;">
                            <canvas id="callsChart" width="540" height="300" style="background:#fff;border-radius:18px;box-shadow:0 2px 16px #eee;display:block;margin:0 auto;"></canvas>
                            <div style="display:flex;gap:25px;justify-content:center;margin-top:10px;">
                                <div style="display:flex;align-items:center;gap:7px;">
                                    <span style="display:inline-block;width:18px;height:8px;background:#3498db;border-radius:4px;"></span>
                                    <span style="font-size:1em;color:#333;">Anrufe</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:7px;">
                                    <span style="display:inline-block;width:18px;height:8px;background:#27ae60;border-radius:4px;"></span>
                                    <span style="font-size:1em;color:#333;">Erfolge</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Новый раздел для календаря -->
        <div class="section calendar-section">
            <div class="header">
                <h1>Kalender & Anruf-Statistik</h1>
            </div>
            <div class="main-content" style="flex-direction:column;gap:30px;max-width:1100px;margin:0 auto;">
                <div class="card" style="padding: 30px;">
                    <div id="calendar-container"></div>
                    <div id="calendar-stats" style="margin-top:24px;"></div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // --- Stages & Tipps ---
        const stages = {
            greeting: {
                title: 'Begrüßung',
                script: `Guten Tag! Mein Name ist [IHR NAME], ich rufe von BVGE an.

Wir helfen Familien und Unternehmen dabei, bei ihren Strom- und Gaskosten zu sparen.

Haben Sie 2-3 Minuten Zeit, damit ich Ihnen erklären kann, wie Sie bis zu 15% Ihrer Energiekosten sparen können?`,
                tips: [
                    'Selbstbewusst und freundlich sprechen',
                    'Auf Zustimmung zum Gespräch warten',
                    'Bei Ablehnung höflich verabschieden',
                    'Sich mit vollem Namen vorstellen'
                ]
            },
            qualification: {
                title: 'Bedarfsermittlung',
                script: `Ausgezeichnet! Lassen Sie mich etwas über Ihre aktuellen Energiekosten erfahren:

1. Sind Sie zufrieden mit der Höhe Ihrer Strom- und Gasrechnungen?

2. Wie viel zahlen Sie ungefähr monatlich für Strom? Und für Gas?

3. Wer ist Ihr aktueller Energieversorger?

4. Wie hoch ist ungefähr Ihr monatlicher Verbrauch in kWh und m³?`,
                tips: [
                    'Aktiv zuhören und Antworten notieren',
                    'Mitgefühl für hohe Kosten zeigen',
                    'Unklare Punkte nachfragen',
                    'NICHT zu schnell mit Angebot kommen'
                ]
            },
            presentation: {
                title: 'Angebotspräsentation',
                script: `Ich verstehe Ihre Situation mit den hohen Energiekosten.

Unser Unternehmen arbeitet direkt mit großen Energieversorgern zusammen und kann Ihnen Tarife anbieten, die 10-15% günstiger sind.

Bei Ihren Kosten von [BETRAG] Euro pro Monat können Sie etwa [ERSPARNIS] Euro monatlich sparen!

Das sind [JAHRESERSPARNIS] Euro im Jahr - eine beachtliche Summe, nicht wahr?`,
                tips: [
                    'KONKRETE Zahlen des Kunden verwenden',
                    'Den Nutzen hervorheben',
                    'Unbedingt Jahresersparnis nennen',
                    'Zeit zum Nachdenken geben'
                ]
            },
            objections: {
                title: 'Einwandbehandlung',
                script: `Ich verstehe Ihre Bedenken - das ist eine normale Reaktion auf ein neues Angebot.

Lassen Sie mich Ihre Fragen beantworten und Ihre Zweifel ausräumen...`,
                tips: [
                    'NICHT mit dem Kunden streiten',
                    'Einwände ruhig annehmen',
                    'Nachfragen stellen',
                    'Konkrete Antworten mit Beispielen geben',
                    'Soziale Beweise verwenden'
                ]
            }, 
            closing: {
                title: 'Abschluss',
                script: `Hervorragend! Ich sehe, dass Sie das Angebot interessante finden.

Für die Vertragsstellung benötige ich nur wenige Minuten. Ich kann die Unterlagen sofort vorbereiten.

Bereits im nächsten Monat erhalten Sie Ihre erste Rechnung mit der Ersparnis!

Wann passt es Ihnen am besten für die Vertragsunterzeichnung - heute Abend oder morgen?`,
                tips: [
                    'Dringlichkeitsgefühl erzeugen',
                    'Alternativen anbieten (entweder-oder)',
                    'Bereit für Vertragsabschluss sein',
                    'Keine Bedenkzeit geben',
                    'Kontaktdaten sichern'
                ]
            }
        };

        // --- Objection Antworten ---
        const objections = {
            expensive: {
                title: 'Zu teuer',
                response: 'Ich verstehe Ihre Sorge. Tatsächlich entstehen keine zusätzlichen Kosten. Wir werden einfach Ihr neuer Versorger zu günstigeren Tarifen. Alle Zahlungen bleiben gleich, nur die Beträge werden niedriger.'
            },
            think: {
                title: 'Muss überlegen',
                response: 'Natürlich ist das eine wichtige Entscheidung. Aber bedenken Sie: Jeder Monat des Zögerns bedeutet verlorene Ersparnis. Kann ich Ihnen meine Kontaktdaten für Rückfragen hinterlassen?'
            },
            satisfied: {
                title: 'Bin zufrieden',
                response: 'Das ist großartig! Das bedeutet, Sie sind mit der Qualität zufrieden. Was wäre, wenn ich Ihnen sage, dass Sie dieselbe Qualität 10-15% günstiger bekommen können?'
            },
            distrust: {
                title: 'Vertraue nicht',
                response: 'Ich verstehe, es gibt viele unseriöse Anbieter. Wir arbeiten vollkommen legal, alle Dokumente und Lizenzen vorhanden. Ich kann Ihnen Kopien sofort per WhatsApp senden.'
            },
            time: {
                title: 'Keine Zeit',
                response: 'Ich verstehe, dass die Zeit knapp ist. Genau deshalb schlage ich vor, das Thema jetzt in 5 Minuten zu klären, damit Sie sich später nicht mehr damit beschäftigen müssen.'
            },
            contract: {
                title: 'Vertrag läuft',
                response: 'Kein Problem! Wir können den Wechsel so planen, dass er nahtlos nach Ende Ihres aktuellen Vertrags erfolgt. So verpassen Sie keine Ersparnis und haben keine Unterbrechung.'
            }
        };

        // --- Kundendatenbank ---
        let clients = JSON.parse(localStorage.getItem('clients') || '[]');
        let selectedClientId = null;

        function saveClients() {
            localStorage.setItem('clients', JSON.stringify(clients));
        }

        function clearClientForm() {
            document.getElementById('customer-name').value = '';
            document.getElementById('electricity-bill').value = '';
            document.getElementById('gas-bill').value = '';
            document.getElementById('current-provider').value = '';
            document.getElementById('customer-address').value = '';
            document.getElementById('customer-email').value = '';
            selectedClientId = null;
        }

        function addOrUpdateClient() {
            const name = document.getElementById('customer-name').value.trim();
            const electricity = document.getElementById('electricity-bill').value.trim();
            const gas = document.getElementById('gas-bill').value.trim();
            const provider = document.getElementById('current-provider').value.trim();
            const address = document.getElementById('customer-address').value.trim();
            const email = document.getElementById('customer-email').value.trim();

            if (!name) { alert('Name erforderlich'); return; }

            if (selectedClientId) {
                // Update
                const idx = clients.findIndex(c => c.id === selectedClientId);
                if (idx > -1) {
                    clients[idx] = { id: selectedClientId, name, electricity, gas, provider, address, email };
                }
                selectedClientId = null;
            } else {
                // Add
                const id = Date.now() + Math.floor(Math.random() * 10000);
                clients.push({ id, name, electricity, gas, provider, address, email });
            }
            saveClients();
            renderClients();
            // clearClientForm(); // Optional: не очищать форму после сохранения
        }

        function deleteClient() {
            if (!selectedClientId) return;
            if (!confirm('Kunde wirklich löschen?')) return;
            clients = clients.filter(c => c.id !== selectedClientId);
            saveClients();
            renderClients();
            clearClientForm();
        }

        function renderClients() {
            const tbody = document.querySelector('#clients-table tbody');
            if (!tbody) return;
            tbody.innerHTML = '';
            const search = (document.getElementById('search-client')?.value || '').toLowerCase();
            clients.filter(c =>
                c.name.toLowerCase().includes(search) ||
                c.address.toLowerCase().includes(search) ||
                c.email.toLowerCase().includes(search) ||
                c.provider.toLowerCase().includes(search)
            ).forEach(c => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <button style="border:none;background:none;cursor:pointer;color:#3498db;" title="Bearbeiten" onclick="editClient(${c.id})">✎</button>
                    </td>
                    <td>${c.name}</td>
                    <td>${c.address}</td>
                    <td>${c.email}</td>
                    <td>${c.electricity}</td>
                    <td>${c.gas}</td>
                    <td>${c.provider}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function editClient(id) {
            const c = clients.find(c => c.id === id);
            if (!c) return;
            // Заполняем форму справа в Kundenverwaltung
            document.getElementById('kunden-customer-name').value = c.name;
            document.getElementById('kunden-customer-address').value = c.address;
            document.getElementById('kunden-customer-email').value = c.email;
            document.getElementById('kunden-electricity-bill').value = c.electricity;
            document.getElementById('kunden-gas-bill').value = c.gas;
            document.getElementById('kunden-current-provider').value = c.provider;
            selectedClientId = id;
        }

        function updateSelectedClient() {
            if (!selectedClientId) return;
            const idx = clients.findIndex(c => c.id === selectedClientId);
            if (idx === -1) return;
            clients[idx] = {
                id: selectedClientId,
                name: document.getElementById('kunden-customer-name').value.trim(),
                address: document.getElementById('kunden-customer-address').value.trim(),
                email: document.getElementById('kunden-customer-email').value.trim(),
                electricity: document.getElementById('kunden-electricity-bill').value.trim(),
                gas: document.getElementById('kunden-gas-bill').value.trim(),
                provider: document.getElementById('kunden-current-provider').value.trim()
            };
            saveClients();
            renderClients();
            // optionally clear form
            // selectedClientId = null;
        }

        function exportClientsCSV() {
            if (!clients.length) { alert('Keine Daten zum Exportieren'); return; }
            let csv = 'Name,Adresse,Email,Strom,Gas,Anbieter\n';
            clients.forEach(c => {
                csv += `"${c.name}","${c.address}","${c.email}","${c.electricity}","${c.gas}","${c.provider}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'clients.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- Stages ---
        function showStage(stage, event) {
            document.querySelectorAll('.stage-btn').forEach(b => b.classList.remove('active'));
            // Fix: event may be undefined or event.target may be undefined
            if (event && event.target) {
                event.target.classList.add('active');
            }
            const stageData = stages[stage];
            document.getElementById('stage-title').textContent = stageData.title;
            document.getElementById('stage-script').textContent = stageData.script;
            const tipsHtml = stageData.tips.map(tip => `<li>${tip}</li>`).join('');
            document.getElementById('stage-tips').innerHTML = `<h4>Wichtige Tipps:</h4><ul>${tipsHtml}</ul>`;
        }

        // --- Objection Buttons ---
        function showObjection(objectionKey, event) {
            document.querySelectorAll('.objection-btn').forEach(b => b.classList.remove('active'));
            if (event && event.target) event.target.classList.add('active');
            const objection = objections[objectionKey];
            if (!objection) {
                document.getElementById('objection-response').innerHTML = '';
                return;
            }
            document.getElementById('objection-response').innerHTML = `
                <div class="objection-response">
                    <h4>Antwort auf "${objection.title}":</h4>
                    <p>${objection.response}</p>
                </div>
            `;
        }

        // --- Ersparnis-Rechner ---
        function calculateSavings() {
            const electricityBill = parseFloat(document.getElementById('electricity-bill').value) || 0;
            const gasBill = parseFloat(document.getElementById('gas-bill').value) || 0;
            const totalCurrent = electricityBill + gasBill;
            const monthlySavings = Math.round(totalCurrent * 0.12);
            const yearlySavings = monthlySavings * 12;
            if (totalCurrent > 0) {
                document.getElementById('savings-result').innerHTML = `
                    <div class="savings-result">
                        <div style="font-size: 1.2em; margin-bottom: 10px;">💰 Ihre Ersparnis:</div>
                        <div style="font-size: 1.5em; font-weight: bold;">
                            ${monthlySavings}€ pro Monat<br>
                            ${yearlySavings}€ pro Jahr
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('savings-result').innerHTML = '';
                alert('Bitte geben Sie gültige Beträge ein.');
            }
        }

        // --- Statistik ---
        let callsHistory = [];
        let callCount = 0;
        let successCount = 0;
        let statsFilter = 'all';

        // --- Загрузка и сохранение статистики ---
        function loadStats() {
            const data = JSON.parse(localStorage.getItem('callsHistory') || '[]');
            callsHistory = Array.isArray(data) ? data : [];
        }
        function saveStats() {
            localStorage.setItem('callsHistory', JSON.stringify(callsHistory));
        }

        // --- Фильтрация по дате ---
        function filterHistoryByPeriod(period) {
            const now = new Date();
            return callsHistory.filter(entry => {
                const d = new Date(entry.date);
                if (period === 'day') {
                    return d.toDateString() === now.toDateString();
                }
                if (period === 'week') {
                    // Неделя: последние 7 дней включая сегодня
                    const diff = (now - d) / (1000 * 60 * 60 * 24);
                    return diff >= 0 && diff < 7 && d <= now;
                }
                if (period === 'month') {
                    return d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth();
                }
                return true; // 'all'
            });
        }

        function recalcStats() {
            const filtered = filterHistoryByPeriod(statsFilter);
            callCount = filtered.length;
            successCount = filtered.filter(e => e.success).length;
            document.getElementById('calls-count').textContent = callCount;
            document.getElementById('success-count').textContent = successCount;
            updateSuccessRate();
            // Показываем дату последнего звонка, если есть соответствующий элемент
            if (document.getElementById('last-call-date')) {
                document.getElementById('last-call-date').textContent = getLastCallDate(filtered);
            }
            updateUndoButton();
        }

        function applyStatsFilter() {
            statsFilter = document.getElementById('stats-filter').value;
            recalcStats();
            drawCallsChart();
        }

        function addCall() {
            const now = new Date();
            let success = confirm('War dieser Anruf erfolgreich?');
            callsHistory.push({
                date: now.toISOString(),
                success: !!success
            });
            saveStats();
            recalcStats();
            drawCallsChart();
            updateUndoButton();
        }

        function undoLastCall() {
            if (callsHistory.length === 0) return;
            if (!confirm('Letzte Aktion wirklich rückgängig machen?')) return;
            callsHistory.pop();
            saveStats();
            recalcStats();
            drawCallsChart();
            updateUndoButton();
        }

        function updateUndoButton() {
            const btn = document.getElementById('undo-call-btn');
            btn.disabled = callsHistory.length === 0;
        }

        function updateSuccessRate() {
            const rateSpan = document.getElementById('success-rate');
            let percent = 0;
            if (callCount > 0) {
                percent = Math.round((successCount / callCount) * 100);
            }
            rateSpan.textContent = percent + '%';
            if (percent < 33) {
                rateSpan.style.background = '#ffeaea';
                rateSpan.style.color = '#e74c3c';
            } else if (percent < 50) {
                rateSpan.style.background = '#fffbe5';
                rateSpan.style.color = '#f39c12';
            } else {
                rateSpan.style.background = '#eafaf1';
                rateSpan.style.color = '#27ae60';
            }
        }

        function drawCallsChart() {
            const canvas = document.getElementById('callsChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Для графика используем только отфильтрованные данные
            const filtered = filterHistoryByPeriod(statsFilter);

            // Считаем кумулятивно для графика
            let chartData = [];
            let calls = 0, successes = 0;
            filtered.forEach(entry => {
                calls++;
                if (entry.success) successes++;
                chartData.push({ call: calls, success: successes });
            });

            // Chart area
            const chart = {
                left: 60,
                top: 30,
                width: canvas.width - 90,
                height: canvas.height - 70
            };

            // Draw axes
            ctx.strokeStyle = "#bbb";
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(chart.left, chart.top);
            ctx.lineTo(chart.left, chart.top + chart.height);
            ctx.lineTo(chart.left + chart.width, chart.top + chart.height);
            ctx.stroke();

            // Draw grid lines and Y labels
            ctx.font = "13px Segoe UI, Arial";
            ctx.fillStyle = "#888";
            let maxY = Math.max(...chartData.map(h => Math.max(h.call, h.success)), 5);
            let ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                let y = chart.top + chart.height - (i * chart.height / ySteps);
                ctx.beginPath();
                ctx.moveTo(chart.left, y);
                ctx.lineTo(chart.left + chart.width, y);
                ctx.strokeStyle = "#eee";
                ctx.stroke();
                ctx.fillText(Math.round(maxY * i / ySteps), chart.left - 38, y + 5);
            }

            // Draw X labels (every 5th or last)
            ctx.font = "12px Segoe UI, Arial";
            ctx.fillStyle = "#888";
            let len = chartData.length;
            for (let i = 0; i < len; i++) {
                if (i % 5 === 0 || i === len - 1) {
                    let x = chart.left + (i * chart.width / Math.max(1, len - 1));
                    ctx.fillText(i + 1, x - 6, chart.top + chart.height + 22);
                }
            }

            // Draw callCount line (blue)
            if (chartData.length > 0) {
                ctx.strokeStyle = "#3498db";
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                chartData.forEach((h, i) => {
                    let x = chart.left + (i * chart.width / Math.max(1, len - 1));
                    let y = chart.top + chart.height - (h.call / maxY) * chart.height;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();

                // Draw points
                chartData.forEach((h, i) => {
                    let x = chart.left + (i * chart.width / Math.max(1, len - 1));
                    let y = chart.top + chart.height - (h.call / maxY) * chart.height;
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    ctx.fillStyle = "#3498db";
                    ctx.fill();
                });

                // Draw successCount line (green)
                ctx.strokeStyle = "#27ae60";
                ctx.lineWidth = 2.5;
                ctx.beginPath();
                chartData.forEach((h, i) => {
                    let x = chart.left + (i * chart.width / Math.max(1, len - 1));
                    let y = chart.top + chart.height - (h.success / maxY) * chart.height;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.stroke();

                // Draw points
                chartData.forEach((h, i) => {
                    let x = chart.left + (i * chart.width / Math.max(1, len - 1));
                    let y = chart.top + chart.height - (h.success / maxY) * chart.height;
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    ctx.fillStyle = "#27ae60";
                    ctx.fill();
                });
            }
        }

        // --- Navigation Tabs ---
        function showSection(sectionClass, btn) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            if (btn) btn.classList.add('active');
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            document.querySelector('.' + sectionClass).classList.add('active');

            // Scroll to the section (magnet effect)
            setTimeout(function() {
                const section = document.querySelector('.' + sectionClass);
                if (section) {
                    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 50);

            // Draw chart if stats-section
            if (sectionClass === 'stats-section') {
                recalcStats();
                drawCallsChart();
            }
            if (sectionClass === 'calendar-section') {
                renderCalendar();
            }
        }

        // --- Initialisierung ---
        loadStats();
        recalcStats();
        renderClients();
        showStage('greeting', {target: document.querySelector('.stage-btn.active')});
        updateUndoButton();

        // --- Календарь ---
        function renderCalendar(selectedDate) {
            const container = document.getElementById('calendar-container');
            if (!container) return;

            const now = selectedDate ? new Date(selectedDate) : new Date();
            const year = now.getFullYear();
            const month = now.getMonth();

            // Первый день месяца
            const firstDay = new Date(year, month, 1);
            let startDay = firstDay.getDay();
            if (startDay === 0) startDay = 7; // Понедельник - первый день недели

            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Для выделения выбранного дня
            let selectedDayStr = window._calendarSelectedDay || (selectedDate ? selectedDate : (new Date()).toISOString().slice(0,10));

            let html = `<div class="calendar-header-bar">
                <button onclick="changeCalendarMonth(-1)" title="Vorheriger Monat">&#8592;</button>
                <span>${now.toLocaleString('de-DE', { month: 'long', year: 'numeric' })}</span>
                <button onclick="changeCalendarMonth(1)" title="Nächster Monat">&#8594;</button>
            </div>`;
            html += `<table class="calendar-table">
                <thead>
                    <tr>
                        <th>Mo</th><th>Di</th><th>Mi</th><th>Do</th><th>Fr</th><th>Sa</th><th>So</th>
                    </tr>
                </thead>
                <tbody>
            `;

            let day = 1;
            for (let row = 0; row < 6; row++) {
                html += '<tr>';
                for (let col = 1; col <= 7; col++) {
                    if ((row === 0 && col < startDay) || day > daysInMonth) {
                        html += '<td></td>';
                    } else {
                        let isToday = (day === (new Date()).getDate() && month === (new Date()).getMonth() && year === (new Date()).getFullYear());
                        let dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                        let calls = callsHistory.filter(e => (new Date(e.date)).toISOString().slice(0,10) === dateStr);
                        let total = calls.length;
                        let success = calls.filter(e => e.success).length;
                        let percent = total ? Math.round(success/total*100) : 0;
                        let bg = "";
                        if (total > 0) {
                            if (percent < 33) bg = "red";
                            else if (percent < 50) bg = "yellow";
                            else bg = "green";
                        }
                        let selectedClass = (dateStr === selectedDayStr) ? 'selected' : '';
                        html += `<td 
                            class="${isToday ? 'today' : ''} ${selectedClass}" 
                            data-bg="${bg}" 
                            data-has-calls="${total > 0 ? 1 : 0}"
                            data-date="${dateStr}"
                            onclick="calendarDayClick(this, '${dateStr}')"
                            tabindex="0"
                        >
                            <span class="cal-day-num">${day}</span>
                            <span class="cal-calls">${total > 0 ? `📞${total} <span style='color:#27ae60;'>✔${success}</span>` : ''}</span>
                        </td>`;
                        day++;
                    }
                }
                html += '</tr>';
                if (day > daysInMonth) break;
            }
            html += '</tbody></table>';
            container.innerHTML = html;

            // Показать статистику за выбранный день (по умолчанию сегодня)
            showCalendarStats(selectedDayStr);
            container.dataset.year = year;
            container.dataset.month = month;
        }

        // Обработчик клика по дню календаря
        function calendarDayClick(td, dateStr) {
            // Убрать выделение со всех
            document.querySelectorAll('.calendar-table td.selected').forEach(el => el.classList.remove('selected'));
            td.classList.add('selected');
            window._calendarSelectedDay = dateStr;
            showCalendarStats(dateStr);
        }

        function changeCalendarMonth(delta) {
            const container = document.getElementById('calendar-container');
            let year = parseInt(container.dataset.year, 10);
            let month = parseInt(container.dataset.month, 10);
            month += delta;
            if (month < 0) { month = 11; year--; }
            if (month > 11) { month = 0; year++; }
            renderCalendar(`${year}-${String(month+1).padStart(2,'0')}-01`);
        }

        function showCalendarStats(dateStr) {
            const statsDiv = document.getElementById('calendar-stats');
            const calls = callsHistory.filter(e => (new Date(e.date)).toISOString().slice(0,10) === dateStr);
            const total = calls.length;
            const success = calls.filter(e => e.success).length;
            let percent = total ? Math.round(success/total*100) : 0;
            let color = percent < 33 ? '#e74c3c' : (percent < 50 ? '#f39c12' : '#27ae60');
            let dateObj = new Date(dateStr);
            statsDiv.innerHTML = `
                <div style="font-size:1.2em;font-weight:600;margin-bottom:8px;">
                    Statistik für <span style="color:#3498db">${dateObj.toLocaleDateString('de-DE')}</span>
                </div>
                <div style="font-size:1.1em;margin-bottom:6px;">
                    <b>Gesamtanrufe:</b> <span style="color:#3498db;font-weight:bold;">${total}</span>
                </div>
                <div style="font-size:1.1em;margin-bottom:6px;">
                    <b>Erfolgreiche Abschlüsse:</b> <span style="color:#27ae60;font-weight:bold;">${success}</span>
                </div>
                <div style="font-size:1.1em;margin-bottom:6px;">
                    <b>Erfolgsquote:</b> <span style="font-weight:bold;padding:2px 10px;border-radius:8px;background:#eee;color:${color};">${percent}%</span>
                </div>
            `;
        }
    </script>
    <div class="author-initials">Created by Vladimir</div>
</body>
</html>
